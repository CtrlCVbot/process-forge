---
name: sub-agent-writer
description: Claude Code용 서브에이전트(Subagent)를 작성하는 방법을 안내합니다. 사용자가 새 에이전트를 "만들어줘", "작성해줘", "설계해줘" 요청하거나, .agent/agents 폴더, agent frontmatter, 서브에이전트 구조에 대해 질문할 때 사용합니다.
---

# 서브에이전트 작성 도우미

이 스킬은 Claude Code용 서브에이전트(Subagent)를 모범 사례와 검증 요구사항에 맞게 작성할 수 있도록 안내합니다.

## 사용 시점

이 스킬을 사용하는 경우:
- 새로운 서브에이전트 생성
- `.agent/agents/` 폴더에 에이전트 파일 작성 또는 수정
- 에이전트 frontmatter 및 구조 설계
- 에이전트 활성화 문제 해결
- 기존 스킬이나 워크플로우를 서브에이전트로 전환

## 핵심 개념

### 스킬 vs 서브에이전트 비교

| 특성 | 스킬 (Skill) | 서브에이전트 (Subagent) |
|------|-------------|----------------------|
| **컨텍스트** | 메인 대화 공유 | 독립적인 컨텍스트 |
| **활성화** | 요청과 자동 매칭 | 자동 위임 또는 명시적 호출 |
| **도구 제한** | `allowed-tools` 필드 | `tools` 필드 |
| **모델 선택** | 부모 모델 상속 | `model` 필드로 지정 가능 |
| **스킬 로드** | 불가 | `skills` 필드로 가능 |
| **권한 모드** | 불가 | `permissionMode` 필드 |
| **비용** | 메인 컨텍스트 공유 | 독립 컨텍스트 (토큰 추가) |

### 서브에이전트 사용 기준

**서브에이전트가 적합한 경우:**
- 독립적인 컨텍스트가 필요한 작업
- 다단계 복합 작업 수행
- 도구 접근을 제한해야 할 때
- 다른 모델(Haiku, Opus)을 사용해야 할 때
- 여러 스킬을 조합해야 할 때
- 메인 대화를 오염시키지 않고 탐색해야 할 때

**스킬이 적합한 경우:**
- 메인 대화 컨텍스트가 필요한 작업
- 가벼운 지식/가이드 제공
- 항상 자동으로 적용되어야 할 규칙
- 단일 목적의 간단한 작업

## 지침

### 1단계: 에이전트 범위 결정

먼저, 에이전트가 수행할 작업을 파악합니다:

1. **명확한 질문하기**:
   - 이 에이전트가 제공해야 할 구체적인 기능은?
   - 독립적인 컨텍스트가 필요한가?
   - 어떤 도구가 필요한가? (전체 또는 제한)
   - 어떤 모델이 적합한가? (속도 vs 성능)
   - 기존 스킬을 조합해야 하는가?

2. **범위를 좁게 유지**: 하나의 에이전트 = 하나의 목적
   - 좋은 예: "코드 리뷰 전문가", "테스트 실행기"
   - 너무 넓은 예: "개발 도우미", "코드 작업"

### 2단계: 에이전트 위치 선택

에이전트를 생성할 위치를 결정합니다:

**개인 에이전트** (`~/.agent/agents/`):
- 개인 워크플로우 및 선호 설정
- 실험적인 에이전트
- 모든 프로젝트에서 사용

**프로젝트 에이전트** (`.agent/agents/`):
- 팀 워크플로우 및 규칙
- 프로젝트별 전문 에이전트
- 공유 유틸리티 (git에 커밋)

**CLI 에이전트** (`--agents` 플래그):
- 빠른 테스트
- 세션별 임시 에이전트
- 자동화 스크립트

### 3단계: 에이전트 파일 생성

파일을 생성합니다 (스킬과 달리 디렉토리 불필요):

```bash
# 개인용
touch ~/.agent/agents/에이전트명.md

# 프로젝트용
mkdir -p .agent/agents
touch .agent/agents/에이전트명.md
```

**파일명 규칙**: `에이전트명.md` (frontmatter `name`과 일치)

### 4단계: Frontmatter 작성

필수 필드가 포함된 YAML frontmatter를 작성합니다:

```yaml
---
name: 에이전트명
description: 이 에이전트가 무엇을 하는지, 언제 사용하는지 간략히 설명
---
```

**필드 요구사항**:

| 필드 | 필수 | 설명 | 예시 |
|------|------|------|------|
| `name` | O | 소문자, 숫자, 하이픈만, 최대 64자 | `code-reviewer` |
| `description` | O | 무엇/언제, 최대 1024자 | "코드 리뷰를 수행합니다..." |
| `tools` | X | 쉼표로 구분, 사용할 도구 제한 | `Read, Grep, Glob` |
| `model` | X | 사용할 모델 | `sonnet`, `opus`, `haiku`, `inherit` |
| `permissionMode` | X | 권한 모드 | `default`, `acceptEdits`, `dontAsk` |
| `skills` | X | 로드할 스킬 목록 | `skill1, skill2` |

### 5단계: 효과적인 설명 작성

설명은 Claude가 에이전트를 위임하는 데 매우 중요합니다.

**공식**: `[무엇을 하는지] + [언제 위임되는지] + [핵심 트리거]`

**예시**:

✅ **좋은 예**:
```yaml
description: 코드를 읽기 전용으로 탐색하고 구조를 분석합니다. 코드베이스 파악, 아키텍처 분석, 파일 검색 요청 시 사용합니다.
```

✅ **좋은 예**:
```yaml
description: 테스트를 실행하고 실패한 테스트를 수정합니다. 코드 변경 후 테스트 실행 요청, 테스트 실패 수정 요청 시 사용합니다.
```

❌ **너무 모호한 예**:
```yaml
description: 코드 관련 도움
description: 개발 작업 수행
```

**팁**:
- 구체적인 작업 동사 포함 (탐색, 분석, 실행, 수정)
- 일반적인 사용자 표현 언급 ("~해줘", "~분석해줘")
- 컨텍스트 단서 추가 ("~할 때 사용", "~요청 시")

### 6단계: 에이전트 지시사항 구조화

명확한 마크다운 섹션을 사용합니다:

```markdown
# 에이전트명

이 에이전트가 무엇을 하는지 간략한 개요.

## 역할

에이전트의 역할과 책임을 명확히 정의합니다.

## 절차

Claude가 따를 단계별 지침:
1. 명확한 작업이 포함된 첫 번째 단계
2. 예상 결과가 포함된 두 번째 단계
3. 예외 상황 처리

## 제약 조건

- 하지 말아야 할 것
- 지켜야 할 규칙
- 범위 제한

## 출력 형식

결과물의 형식을 정의합니다.
```

### 7단계: 도구/모델/권한 설정

**tools 필드** - 사용할 도구 제한:
```yaml
tools: Read, Grep, Glob, Bash
```

사용 가능한 도구:
- `Read`: 파일 읽기
- `Edit`: 파일 수정
- `Write`: 파일 생성
- `Bash`: 명령 실행
- `Grep`: 내용 검색
- `Glob`: 파일 패턴 검색
- `WebFetch`: 웹 콘텐츠 가져오기
- `WebSearch`: 웹 검색
- `Task`: 서브에이전트 실행

**model 필드** - 모델 선택:
```yaml
model: haiku  # 빠르고 저렴, 간단한 작업
model: sonnet  # 균형, 대부분의 작업
model: opus  # 최고 성능, 복잡한 작업
model: inherit  # 부모 모델 상속
```

**permissionMode 필드** - 권한 모드:
```yaml
permissionMode: default  # 기본 권한 요청
permissionMode: acceptEdits  # 수정 자동 승인
permissionMode: dontAsk  # 권한 요청 안 함
```

### 8단계: 스킬 연동 (선택)

기존 스킬을 에이전트에 로드할 수 있습니다:

```yaml
---
name: process-architect
description: 프로세스 분석/설계/문서화를 총괄합니다.
skills: process-analyzer, process-designer, process-documenter
---
```

**주의**: 서브에이전트는 부모 대화의 스킬을 상속하지 않습니다. 필요한 스킬은 명시적으로 지정해야 합니다.

### 9단계: 에이전트 검증

다음 요구사항을 확인합니다:

✅ **파일 구조**:
- [ ] 에이전트 파일이 `.agent/agents/` 또는 `~/.agent/agents/`에 존재
- [ ] 파일명이 frontmatter `name`과 일치

✅ **YAML frontmatter**:
- [ ] 첫 줄에 `---` 시작
- [ ] 내용 전에 `---` 종료
- [ ] 유효한 YAML (탭 없음, 올바른 들여쓰기)
- [ ] `name`이 명명 규칙 준수
- [ ] `description`이 구체적이고 1024자 미만

✅ **선택적 필드**:
- [ ] `tools` 필드가 유효한 도구만 참조 (해당 시)
- [ ] `model` 필드가 유효한 값 (해당 시)
- [ ] `skills` 필드가 존재하는 스킬만 참조 (해당 시)

✅ **내용 품질**:
- [ ] 에이전트 역할이 명확하게 정의됨
- [ ] 수행 절차가 단계별로 구성됨
- [ ] 제약 조건이 명시됨

### 10단계: 테스트 및 디버그

1. **Claude Code 재시작** (실행 중인 경우) - 에이전트 로드

2. **`/agents` 명령으로 확인**:
   ```
   /agents
   ```
   에이전트가 목록에 나타나는지 확인

3. **관련 질문으로 테스트**:
   ```
   코드베이스 구조 분석해줘
   ```

4. **동작 확인**: Claude가 자동으로 에이전트를 위임하는지 확인

## 일반적인 패턴

### 읽기 전용 에이전트 (Explore 타입)

```yaml
---
name: code-explorer
description: 코드베이스를 읽기 전용으로 탐색하고 구조를 분석합니다. 코드 구조 파악, 아키텍처 분석, 파일 검색 요청 시 사용합니다.
tools: Read, Grep, Glob
model: haiku
---

# 코드 탐색기

코드베이스를 읽기 전용으로 탐색하여 구조와 패턴을 분석합니다.

## 역할

- 코드베이스 구조 파악
- 아키텍처 패턴 분석
- 파일 및 함수 검색

## 제약 조건

- 파일 수정 금지
- 읽기 도구만 사용 (Read, Grep, Glob)
- 분석 결과만 반환

## 출력 형식

분석 결과를 구조화된 마크다운으로 반환합니다.
```

### 전체 권한 에이전트 (General-purpose 타입)

```yaml
---
name: refactor-agent
description: 코드 리팩토링을 수행합니다. 코드 개선, 구조 변경, 클린업 요청 시 사용합니다.
model: sonnet
---

# 리팩토링 에이전트

코드 품질 개선을 위한 리팩토링을 수행합니다.

## 역할

- 코드 구조 개선
- 중복 제거
- 가독성 향상

## 절차

1. 현재 코드 분석
2. 개선 포인트 식별
3. 안전한 리팩토링 수행
4. 테스트 실행 확인

## 제약 조건

- 기능 변경 없이 구조만 개선
- 테스트 통과 확인 필수
```

### 계획 전용 에이전트 (Plan 타입)

```yaml
---
name: architecture-planner
description: 아키텍처 설계와 구현 계획을 수립합니다. 설계 요청, 계획 수립, 구현 방향 결정 시 사용합니다.
tools: Read, Grep, Glob
model: sonnet
---

# 아키텍처 플래너

읽기 전용으로 코드를 분석하고 구현 계획을 수립합니다.

## 역할

- 현재 아키텍처 분석
- 구현 계획 수립
- 의존성 분석

## 출력 형식

## 아키텍처 분석
[현재 구조 설명]

## 구현 계획
1. [첫 번째 단계]
2. [두 번째 단계]

## 의존성
- [의존성 목록]
```

### 스킬 연동 에이전트

```yaml
---
name: process-architect
description: 프로세스 분석/설계/문서화를 총괄합니다. 프로세스 관련 복합 작업 요청 시 사용합니다.
model: sonnet
skills: process-analyzer, process-designer, process-documenter
---

# 프로세스 아키텍트

프로세스 관련 스킬을 조합하여 복합 작업을 수행합니다.

## 역할

여러 스킬을 조합하여 프로세스 관련 종합 작업을 수행합니다.

## 연동 스킬

- **process-analyzer**: 현황 분석
- **process-designer**: 개선 설계
- **process-documenter**: 문서화

## 절차

1. process-analyzer로 현황 분석
2. 분석 결과 기반 개선점 도출
3. process-designer로 개선 설계
4. process-documenter로 문서화
```

## 모범 사례

1. **하나의 에이전트, 하나의 목적**: 거대한 범용 에이전트 만들지 않기
2. **최소 권한 원칙**: 필요한 도구만 허용
3. **적절한 모델 선택**:
   - `haiku`: 빠르고 저렴, 간단한 탐색
   - `sonnet`: 균형, 대부분의 작업
   - `opus`: 복잡한 분석, 고품질 출력
4. **구체적인 설명**: 사용자가 말할 트리거 단어 포함
5. **명확한 제약 조건**: 하지 말아야 할 것을 명시
6. **스킬과의 역할 분담**: 단순 가이드는 스킬, 복합 작업은 에이전트
7. **팀원과 테스트**: 위임 트리거와 동작 확인

## 검증 체크리스트

에이전트 완성 전 확인:

**기본 검증**:
- [ ] name이 소문자, 하이픈만, 최대 64자
- [ ] 파일명이 name과 일치 (`name.md`)
- [ ] description이 구체적이고 1024자 미만
- [ ] description에 "무엇"과 "언제" 포함
- [ ] YAML frontmatter가 유효함

**선택적 필드 검증**:
- [ ] tools가 유효한 도구만 참조
- [ ] model이 유효한 값 (sonnet/opus/haiku/inherit)
- [ ] skills가 존재하는 스킬만 참조
- [ ] permissionMode가 유효한 값

**내용 검증**:
- [ ] 역할이 명확하게 정의됨
- [ ] 절차가 단계별로 구성됨
- [ ] 제약 조건이 명시됨
- [ ] 출력 형식이 정의됨

**테스트 검증**:
- [ ] `/agents`에서 에이전트 확인됨
- [ ] 관련 쿼리에 에이전트 활성화됨
- [ ] 지정한 도구만 사용됨 (tools 설정 시)
- [ ] 연동 스킬이 로드됨 (skills 설정 시)

## 문제 해결

**에이전트가 활성화되지 않음**:
- description을 더 구체적으로 수정
  - 트리거 단어 추가
  - 사용 상황을 명확히 기술
- 파일 위치 확인
  ```bash
  ls ~/.agent/agents/에이전트명.md
  ls .agent/agents/에이전트명.md
  ```
- YAML 검증 (탭 없음, 올바른 들여쓰기)
- Claude Code 재시작

**도구가 작동하지 않음**:
- 유효한 도구 이름인지 확인
- 도구 이름 대소문자 확인 (Read, Grep, Glob 등)
- 쉼표로 정확히 구분되었는지 확인

**스킬이 로드되지 않음**:
- 스킬 이름이 정확한지 확인
- 스킬 파일이 존재하는지 확인
- 스킬 자체가 유효한지 별도 테스트

**권한 오류**:
- permissionMode 값 확인
- 필요한 도구가 허용되는지 확인
- tools 필드에 필요한 도구가 포함되었는지 확인

**여러 에이전트가 충돌함**:
- description을 더 구별되게 작성
- 다른 트리거 단어 사용
- 각 에이전트의 범위 좁히기

## 예시

완전한 예시:

### 간단한 읽기 전용 에이전트

```yaml
---
name: dependency-checker
description: 프로젝트 의존성을 분석합니다. package.json, requirements.txt 등 의존성 파일을 검토하고 버전 충돌이나 취약점을 확인합니다.
tools: Read, Grep, Glob, Bash
model: haiku
---

# 의존성 검사기

프로젝트 의존성을 분석하고 문제점을 보고합니다.

## 역할

- 의존성 파일 분석 (package.json, requirements.txt 등)
- 버전 충돌 감지
- 오래된 패키지 확인

## 절차

1. 의존성 파일 탐색
2. 각 의존성 버전 확인
3. 문제점 분석
4. 보고서 생성

## 출력 형식

## 의존성 분석 결과

### 발견된 문제
- [문제 목록]

### 권장 사항
- [권장 사항 목록]
```

## 출력 형식

에이전트 생성 시, 다음을 수행합니다:

1. 범위와 요구사항에 대해 명확한 질문
2. 에이전트 이름과 위치 제안
3. 적절한 frontmatter로 에이전트 파일 생성
4. 명확한 역할, 절차, 제약 조건 포함
5. 도구/모델/권한 설정
6. 필요시 스킬 연동
7. 테스트 지침 제공
8. 모든 요구사항에 대해 검증

결과물은 모든 모범 사례와 검증 규칙을 따르는 완전하고 작동하는 서브에이전트입니다.

## 관련 스킬

- **skill-writer**: 스킬 작성 시 참조
